{"compress":true,"commitItems":[["f1ec2cbe-470d-461d-a35c-c0f64ab1e277",1521136114892,"[TOC]\n\n# 1 MapReduce原理\n\nmapreduce&yarn的工作机制\n\n![](http://ww1.sinaimg.cn/large/0063bT3ggy1fml5yxee4jj31ty0n442c.jpg)\n\nmapReduce原理剖析\n\n![](http://ww1.sinaimg.cn/large/0063bT3ggy1fml5yxafipj31r80h0mzc.jpg)\n\nShuffle原理\n\n![](http://ww1.sinaimg.cn/large/0063bT3ggy1fml5yxiyb3j31ty0n4whw.jpg)\n\nmapreduce运行全流程\n\n![](http://ww1.sinaimg.cn/large/0063bT3ggy1fml5yx8veaj311c0kgmyp.jpg)\n\nmapTask任务分配机制\n\n![](http://ww1.sinaimg.cn/large/0063bT3ggy1fml5yxdrjwj313s1dg76u.jpg)\n\n\n\n# 2 疑问\n\n1. map的结果输出在哪里，在hdfs的指定目录下面？如果是，那么目录结构又是什么样子的？又是如何指定的呢？\n\n2. shuffle的过程是将所有的map结果进行归并和划分，哪里取数据，参考问题1，这个归并过程在reduce的进程里面处理，还是在reduce程序启动前已经处理好了。\n\n3. 如何启动多个map任务，分片？那么如何分，代码都是一样的怎么看出来分了片。在map函数外部分？？inputformat？\n\n   自定义Partitioner\n\n   ```java\n   @Override\n   \tpublic int getPartition(Text key, FlowBean value, int numPartitions) {\n   \t\t\n   \t\tString prefix = key.toString().substring(0,3);\n   \t\tInteger partNum = pmap.get(prefix);\n   \t\t\n   \t\treturn (partNum==null?4:partNum);\n   \t}\n\n   ```\n\n   ​\n\n4. map的输出会进行分区，分区是如何做的？分区的数量如何判断？分区和reduce的对应关系又是如何？\n\n   自定义partition后，要根据自定义partitioner的逻辑设置相应数量的reduce task\n\n   ```\n   job.setNumReduceTasks(5);\n   ```\n\n   注意：\n\n   - 如果reduceTask的数量>= getPartition的结果数  ，则会多产生几个空的输出文件part-r-000xx\n   - 如果 1<reduceTask的数量<getPartition的结果数 ，则有一部分分区数据无处安放，会Exception！！！\n   - 如果 reduceTask的数量=1，则不管mapTask端输出多少个分区文件，最终结果都交给这一个reduceTask，最终也就只会产生一个结果文件 part-r-00000\n\n   ​",[[1521136058891,["wanghuan@DESKTOP-VT81TGT",[[-1,0,"[TOC]"],[1,5,"MapReduce"]],[0,0],[9,9]]],[1521136070986,["wanghuan@DESKTOP-VT81TGT",[[1,0,"---\ntitle: MapReduce介绍\ndate: 2018/3/15 20:46:25\ncategory:\n- 大数据\n- "],[1,10,"tag:\n- MapReduce\ncomments: true  \n---"]],[0,10],[113,113]]],[1521136072923,["wanghuan@DESKTOP-VT81TGT",[[-1,20,"介绍"]],[22,22],[20,20]]],[1521136074132,["wanghuan@DESKTOP-VT81TGT",[[1,20,"shen"]],[20,20],[24,24]]],[1521136075447,["wanghuan@DESKTOP-VT81TGT",[[-1,20,"shen"]],[24,24],[20,20]]],[1521136077457,["wanghuan@DESKTOP-VT81TGT",[[1,20,"深入"]],[20,20],[22,22]]]]]]}