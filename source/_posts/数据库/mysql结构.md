---
title: 数据库-mysql
date: 2018/3/15 20:46:25
category:
- 数据库
tag:
- mysql存储引擎
- mysql
comments: true  
---

# MySQL运行原理与基础架构细说

**MySQL**逻辑架构

[![wKiom1LUF8DS1inQAAE8bwOlNTY150.jpg](http://s3.51cto.com/wyfs02/M02/11/8A/wKiom1LUF8DS1inQAAE8bwOlNTY150.jpg)](http://s3.51cto.com/wyfs02/M02/11/8A/wKiom1LUF8DS1inQAAE8bwOlNTY150.jpg)

1.最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于tcp/ip的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。

2.第二层架构主要完成大多少的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化及部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定查询表的顺序，是否利用索引等，最后生成相应的执行操作。如果是select语句，服务器还会查询内部的缓存。如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。

3.存储引擎层，存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API与存储引擎进行通信。不同的存储引擎具有的功能不同，这样我们可以根据自己的实际需要进行选取。

4.数据存储层，主要是将数据存储在运行于裸设备的文件系统之上，并完成与存储引擎的交互。

### 2.存储引擎介绍：

InnoDB引擎：

   1.将数据存储在表空间中，表空间由一系列的数据文件组成，由InnoDB管理；

   2.支持每个表的数据和索引存放在单独文件中(innodb_file_per_table)；

   3.支持事务，采用MVCC来控制并发，并实现标准的4个事务隔离级别，支持外键；

   4.索引基于聚簇索引建立，对于主键查询有较高性能；

   5.数据文件的平台无关性，支持数据在不同的架构平台移植；

   6.能够通过一些工具支持真正的热备。如XtraBackup等；

   7.内部进行自身优化如采取可预测性预读，能够自动在内存中创建hash索引等。

MyISAM引擎：

   1.MySQL5.1中默认，不支持事务和行级锁；

   2.提供大量特性如全文索引、空间函数、压缩、延迟更新等；

   3.数据库故障后，安全恢复性差；

   4.对于只读数据可以忍受故障恢复，MyISAM依然非常适用；

   5.日志服务器的场景也比较适用，只需插入和数据读取操作；

   6.不支持单表一个文件，会将所有的数据和索引内容分别存在两个文件中；

   7.MyISAM对整张表加锁而不是对行，所以不适用写操作比较多的场景；

   8.支持索引缓存不支持数据缓存。

### 存储引擎选取参考因素

1.是否有事务需求

 如果需要事务支持最好选择InnoDB或者XtraDB，如果主要是select和insert操作MyISAM比较合适，一般使用日志型的应用。

2.备份操作需求

 如果能够关闭服务器进行备份，那么该因素可以忽略，如果需要在线进行热备份，则InnoDB引擎是一个不错的选择。

3.故障恢复需求

 在对恢复要求比较好的场景中推荐使用InnoDB，因为MyISAM数据损坏概率比较大而且恢复速度比较慢。

4.性能上的需求

 有些业务需求只有某些特定的存储引擎才能够满足，如地理空间索引也只有MyISAM引擎支持。所以在应用架构需求环境中也需要管理员折衷考虑，当然从各方面比较而言，InnoDB引擎还是默认应该被推荐使用的。

